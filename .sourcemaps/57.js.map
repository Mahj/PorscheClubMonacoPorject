{"version":3,"sources":["../../src/pages/components/cart/cart/cart.module.ts","../../src/pages/components/cart/cart/cart.ts"],"names":[],"mappings":"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","file":"57.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { CartPage } from './cart';\n\n@NgModule({\n  declarations: [\n    CartPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(CartPage),\n  ],\n  exports: [\n    CartPage\n  ]\n})\nexport class CartPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/components/cart/cart/cart.module.ts","import { Component } from '@angular/core';\nimport { IonicPage, NavController, NavParams, LoadingController, AlertController } from 'ionic-angular';\nimport { DatabaseProvider } from \"../../../../providers/database/database\";\nimport { AngularFireAuth } from \"angularfire2/auth\";\n\n/**\n * Generated class for the CartPage page.\n *\n * See http://ionicframework.com/docs/components/#navigation for more info\n * on Ionic pages and navigation.\n */\n@IonicPage()\n@Component({\n  selector: 'page-cart',\n  templateUrl: 'cart.html',\n    })\n\nexport class CartPage {\n    alertOptions: any;\n    total: number;\n    view: string = 'cart';\n\n    uid: any= null;\n    cartItems: Array<CartItem>;\n    historyItems: Array<CartItem>;\n    constructor(private navCtrl: NavController, private navParams: NavParams, private loadingCtrl: LoadingController, private db: DatabaseProvider, private afAuth: AngularFireAuth,\n        public alertCtrl: AlertController) {\n        this.loadData();\n        if (this.navParams.get('goToHistory') == true) {\n            this.switchView('history');\n        }\n\n    }\n\n    switchView(view) {\n        this.view = view;\n    }\n\n    qtyChanged(item) {\n        \n        this.db.updateDocument('cart', item.$key, item).then((e) => {\n            console.log(item.qty);\n            this.loadData();\n        })\n\n    }\n\n    loadData() {\n        let loadingPopup = this.loadingCtrl.create({\n            spinner: 'crescent',\n            content: ''\n        });\n        loadingPopup.present();\n\n        let that = this;\n        this.afAuth.authState.subscribe(userAuth => {\n            if (!userAuth) {\n                this.showLoginChoise();\n                loadingPopup.dismiss();\n                return;\n            }\n\n            this.uid = !!userAuth ? userAuth.uid : null;\n            this.db.getDocuments('cart', ['uid', '==', this.uid])\n                .then(function (e) {\n                    if (!!e) {\n                        let cart = e.filter((x) => {\n                            return !x.bought\n                        });\n\n                        let history = e.filter((x) => {\n                            return x.bought\n                        });\n                        \n                        that.cartItems = cart;\n                        that.historyItems = history;\n\n                        //calculate total\n                        that.total = 0;\n                        cart.forEach((x) => {\n                            let finalPice = x.discount ? x.discoutPrice : x.price;\n                            that.total += finalPice * x.qty;\n                        })\n                    } else {\n                        that.total = 0;\n                        that.cartItems = null;\n                    }\n                    loadingPopup.dismiss();\n                });\n        });\n\n        \n        \n    }\n\n    showLoginChoise() {\n        let prompt = this.alertCtrl.create({\n            title: 'Login',\n            message: \"You need to login to see your products in the cart, please select a login method\",\n          \n            buttons: [\n                {\n                    text: 'Email/Pass login',\n                    handler: data => {\n                        this.navCtrl.push('LoginPage');\n                    }\n                },\n                {\n                    text: 'Social Login',\n                    handler: data => {\n                        this.navCtrl.push('NativeLoginPage');\n                    }\n                }\n            ]\n        });\n        prompt.present();\n    }\n\n    deleteConfirm(key) {\n        let prompt = this.alertCtrl.create({\n            title: 'Delete',\n            message: \"Are you sure you want to delete this item?\",\n\n            buttons: [\n                {\n                    text: 'Yes',\n                    handler: data => {\n                        this.deleteItem(key);\n                        this.loadData();\n                    }\n                },\n                {\n                    text: 'No',\n                    handler: data => {\n                        \n                    }\n                }\n            ]\n        });\n        prompt.present();\n    }\n\n\n    deleteItem(key) {\n        this.db.deleteDocument('cart', key).then((e) => {\n         \n            this.loadData();\n        });\n  }\n\n\n  checkout() {\n      this.navCtrl.push('CheckoutPage', { total: this.total, items: this.cartItems});\n  }\n\n  goToItemDescription(item) {\n      if (item.type == 'shopping') {\n          this.navCtrl.push('ShoppingDetailPage', { itemId: item.categoryKey, subDoc: item.itemKey });\n      } else if (item.type == 'restaurant') {\n          this.navCtrl.push('RestaurantDetailPage', { itemId: item.categoryKey, subDoc: item.itemKey });\n      }\n\n  }\n\n}\n\n\n\n\n\ninterface CartItem {\n    type: string;\n    categoryKey: string;\n    itemKey: string;\n    img: string;\n    price: number;\n    name: string;\n    uid: string;\n    qty: number;\n    $key: string;\n}\n\n\n// WEBPACK FOOTER //\n// ./src/pages/components/cart/cart/cart.ts"],"sourceRoot":""}